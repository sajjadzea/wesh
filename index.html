<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>تحلیل تعاملی بحران عدم تعادل برق ایران</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://unpkg.com/cytoscape@3/dist/cytoscape.min.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Vazirmatn:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <!-- Chosen Palette: "Calm Harmony" - A combination of Slate, Stone, and a touch of Teal for a serious, analytical yet clean feel. -->
    <!-- Application Structure Plan: A top-down, narrative-driven dashboard. It starts with the core problem (the electricity gap), then allows users to explore the 'causes' (PESTLE factors grouped by Supply/Demand), visualizes the system's 'dynamics' with an interactive causal loop, and finally presents the 'solutions'. This structure is chosen over a simple PESTLE list to create a more engaging story, guiding the user from effect to cause to system behavior, which enhances understanding and retention. -->
    <!-- Visualization & Content Choices:
        - Key Metrics (Large Text): Goal: Inform/Impact. Presents critical numbers (deficit, economic loss) for immediate impact. Method: HTML/Tailwind.
        - Supply vs. Demand Trend (Line Chart): Goal: Show Change. Visualizes the widening gap over time. Method: Chart.js Canvas. Interaction: Tooltips on hover. Justification: A line chart is the best tool for showing trends.
        - Energy Mix (Donut Chart): Goal: Show Proportions. Highlights heavy reliance on fossil fuels. Method: Chart.js Canvas. Interaction: Tooltips. Justification: A donut chart is effective for showing parts of a whole.
        - PESTLE Factors (Interactive Cards): Goal: Organize/Inform. Breaks down complex info into manageable, user-driven pieces. Method: HTML/Tailwind/JS for toggling visibility. Justification: Avoids overwhelming users with a wall of text.
        - Causal Loop Diagram (Interactive Diagram): Goal: Show Relationships. Makes the abstract concept of feedback loops tangible. Method: HTML/CSS/JS. Interaction: Clicking nodes reveals info. Justification: This is the core "systems thinking" element, simplified for clarity.
    -->
    <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->
    <style>
        body { font-family: 'Vazirmatn', sans-serif; }
        .chart-container { position: relative; width: 100%; max-width: 800px; margin-left: auto; margin-right: auto; height: 350px; max-height: 50vh; }
        .active-tab { border-color: #0d9488; color: #0d9488; background-color: #f0fdfa; }
        .inactive-tab { border-color: transparent; color: #52525b; }
        .fade-in { animation: fadeIn 0.5s ease-in-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body class="bg-slate-50 text-slate-800">

    <div class="container mx-auto p-4 md:p-8">

        <header class="text-center mb-12">
            <nav class="mb-4">
                <a href="index.html" class="text-teal-700 mx-2">خانه</a>
                <a href="dash/causal-graph.html" class="text-teal-700 mx-2">نمودار علّی عرضه و تقاضای برق</a>
            </nav>
            <h1 class="text-3xl md:text-4xl font-bold text-teal-800 mb-2">بحران عدم تعادل برق ایران: یک نگاه سیستمی</h1>
            <p class="text-lg text-slate-600 max-w-3xl mx-auto">این داشبورد تعاملی، تحلیل جامع PESTLE و تفکر سیستمی از چالش‌های بخش برق ایران را به تصویر می‌کشد و به شما امکان می‌دهد تا دلایل، دینامیک‌ها و راه‌حل‌های بالقوه این بحران را کاوش کنید.</p>
        </header>

        <main>
            <section id="problem" class="mb-16 bg-white p-6 rounded-xl shadow-md">
                <h2 class="text-2xl font-bold text-center mb-2 text-red-700">بخش اول: ابعاد بحران - شکاف فزاینده عرضه و تقاضا</h2>
                <p class="text-center text-slate-600 mb-8 max-w-4xl mx-auto">هسته اصلی بحران برق ایران، ناتوانی فزاینده در تولید برق به میزان تقاضای روزافزون است. این شکاف، که سال به سال عمیق‌تر می‌شود، منجر به خاموشی‌های گسترده و خسارات اقتصادی هنگفت شده است. نمودار و کارت‌های زیر، وضعیت فعلی و روند این چالش را نشان می‌دهند.</p>
                
                <div class="grid md:grid-cols-3 gap-6 text-center mb-10">
                    <div class="bg-red-50 p-6 rounded-lg border border-red-200">
                        <h3 class="text-xl font-semibold text-red-800">کسری تخمینی برق</h3>
                        <p class="text-4xl font-bold text-red-600 my-2">~۲۵٬۰۰۰</p>
                        <p class="text-slate-600">مگاوات در زمان اوج مصرف</p>
                    </div>
                    <div class="bg-amber-50 p-6 rounded-lg border border-amber-200">
                        <h3 class="text-xl font-semibold text-amber-800">خسارت اقتصادی سالانه</h3>
                        <p class="text-4xl font-bold text-amber-600 my-2">~۵-۸</p>
                        <p class="text-slate-600">میلیارد دلار به بخش صنعت</p>
                    </div>
                    <div class="bg-sky-50 p-6 rounded-lg border border-sky-200">
                        <h3 class="text-xl font-semibold text-sky-800">تلفات شبکه</h3>
                        <p class="text-4xl font-bold text-sky-600 my-2">+۱۱٪</p>
                        <p class="text-slate-600">بالاتر از میانگین جهانی (۸٪)</p>
                    </div>
                </div>

                <div class="chart-container">
                    <canvas id="supplyDemandChart"></canvas>
                </div>
            </section>

            <section id="drivers" class="mb-16">
                <h2 class="text-2xl font-bold text-center mb-2 text-teal-800">بخش دوم: ریشه‌های بحران - تحلیل عوامل کلیدی (PESTLE)</h2>
                 <p class="text-center text-slate-600 mb-8 max-w-4xl mx-auto">این بحران محصول مجموعه‌ای از عوامل درهم‌تنیده است. در این بخش، می‌توانید عوامل کلیدی را که به دو دسته اصلی "فشار بر سمت عرضه" و "محرک‌های سمت تقاضا" تقسیم شده‌اند، بررسی کنید. برای مشاهده جزئیات هر عامل، روی آن کلیک کنید.</p>
                <div class="flex justify-center mb-8 border-b border-slate-300">
                    <button id="supply-tab" class="px-6 py-3 font-semibold text-lg border-b-2 transition-all duration-300 active-tab">فشار بر سمت عرضه</button>
                    <button id="demand-tab" class="px-6 py-3 font-semibold text-lg border-b-2 transition-all duration-300 inactive-tab">محرک‌های سمت تقاضا</button>
                </div>

                <div id="drivers-content" class="grid md:grid-cols-2 lg:grid-cols-3 gap-6">
                </div>
            </section>
            
            <section class="mb-16 grid lg:grid-cols-2 gap-8 items-center bg-white p-6 rounded-xl shadow-md">
                <div>
                     <h2 class="text-2xl font-bold text-center lg:text-right mb-2 text-teal-800">وابستگی شدید به سوخت‌های فسیلی</h2>
                     <p class="text-slate-600 mb-6 text-center lg:text-right">سبد تولید برق ایران به شدت به سوخت‌های فسیلی وابسته است. این وابستگی، کشور را در برابر کمبود گاز و نوسانات قیمت آسیب‌پذیر کرده و منجر به آلودگی هوا و انتشار گازهای گلخانه‌ای می‌شود. توسعه کند انرژی‌های تجدیدپذیر (کمتر از ۲٪) این چالش را تشدید می‌کند.</p>
                     <div class="grid grid-cols-2 gap-4 text-center">
                         <div class="bg-teal-50 p-4 rounded-lg">
                             <h4 class="font-semibold text-teal-700">سهم گاز طبیعی</h4>
                             <p class="text-2xl font-bold text-teal-600">~۸۰٪</p>
                         </div>
                         <div class="bg-orange-50 p-4 rounded-lg">
                             <h4 class="font-semibold text-orange-700">سهم نفت و مایعات</h4>
                             <p class="text-2xl font-bold text-orange-600">~۱۳٪</p>
                         </div>
                     </div>
                </div>
                <div class="chart-container h-72 max-h-[40vh]">
                    <canvas id="energyMixChart"></canvas>
                </div>
            </section>

            <section id="loops" class="mb-16 bg-white p-6 rounded-xl shadow-md">
                <h2 class="text-2xl font-bold text-center mb-2 text-teal-800">بخش سوم: دینامیک سیستم - حلقه‌های بازخورد معیوب</h2>
                <p class="text-center text-slate-600 mb-8 max-w-4xl mx-auto">مشکل برق صرفاً مجموعه‌ای از عوامل مجزا نیست، بلکه یک سیستم پویا با حلقه‌های بازخورد تقویت‌کننده است که وضعیت را وخیم‌تر می‌کنند. دیاگرام زیر یکی از این حلقه‌های معیوب کلیدی («حلقه فرسایش سرمایه و ظرفیت») را نشان می‌دهد. برای تعامل، از ابزار زیر استفاده کنید.</p>
                <div class="flex justify-center gap-6 mb-4">
                    <label class="flex items-center gap-2">
                        <input type="checkbox" id="toggle-reinforcing" class="h-4 w-4" checked>
                        <span class="text-sm">نمایش حلقه‌های تقویتی (R)</span>
                    </label>
                    <label class="flex items-center gap-2">
                        <input type="checkbox" id="toggle-balancing" class="h-4 w-4" checked>
                        <span class="text-sm">نمایش حلقه‌های تعادلی (B)</span>
                    </label>
                </div>
                <div class="w-full max-w-4xl mx-auto">
                    <div id="cy" class="w-full h-[600px]"></div>
                </div>
            </section>

            <!-- Sidebar for node details -->
            <div id="node-info-sidebar" class="fixed top-0 right-0 h-full w-80 max-w-sm bg-white shadow-lg p-4 transform translate-x-full transition-transform z-50">
                <div class="flex items-center justify-between mb-4 border-b pb-2">
                    <h2 id="node-info-title" class="font-bold text-lg"></h2>
                    <button id="node-info-close" class="text-slate-500 hover:text-slate-700">&times;</button>
                </div>
                <p id="node-info-desc" class="text-sm text-slate-700 mb-4"></p>
                <ul id="node-info-resources" class="list-disc pr-5 space-y-2 text-sm"></ul>
            </div>

            <section id="solutions" class="bg-teal-50 p-8 rounded-xl border-t-4 border-teal-600">
                <h2 class="text-2xl font-bold text-center mb-6 text-teal-800">بخش چهارم: مسیر پیش رو - رئوس اقدامات پیشنهادی</h2>
                <p class="text-center text-slate-600 mb-8 max-w-4xl mx-auto">برون‌رفت از این بحران نیازمند یک رویکرد جامع و سیستمی است که به طور همزمان به ابعاد مختلف مشکل بپردازد. بر اساس تحلیل انجام‌شده، اقدامات زیر از اهمیت بالایی برخوردارند:</p>
                <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-6">
                    <div class="bg-white p-4 rounded-lg shadow">
                        <h3 class="font-bold text-teal-700 mb-2">۱. اصلاحات حکمرانی و ساختاری</h3>
                        <p class="text-sm text-slate-600">افزایش شفافیت، مبارزه با فساد، و تدوین استراتژی‌های بلندمدت و واقع‌بینانه برای بخش انرژی.</p>
                    </div>
                    <div class="bg-white p-4 rounded-lg shadow">
                        <h3 class="font-bold text-teal-700 mb-2">۲. اصلاح هوشمندانه یارانه‌ها</h3>
                        <p class="text-sm text-slate-600">کاهش مصرف بی‌رویه و آزادسازی منابع مالی، همراه با طراحی سازوکارهای حمایتی برای اقشار آسیب‌پذیر.</p>
                    </div>
                    <div class="bg-white p-4 rounded-lg shadow">
                        <h3 class="font-bold text-teal-700 mb-2">۳. جذب سرمایه‌گذاری گسترده</h3>
                        <p class="text-sm text-slate-600">تلاش برای رفع موانع و جذب سرمایه برای نوسازی نیروگاه‌ها و توسعه شبکه انتقال و توزیع.</p>
                    </div>
                    <div class="bg-white p-4 rounded-lg shadow">
                        <h3 class="font-bold text-teal-700 mb-2">۴. تسریع در توسعه تجدیدپذیرها</h3>
                        <p class="text-sm text-slate-600">رفع موانع قانونی، مالی و فناورانه برای افزایش سهم انرژی‌های پاک (خورشیدی و بادی).</p>
                    </div>
                    <div class="bg-white p-4 rounded-lg shadow">
                        <h3 class="font-bold text-teal-700 mb-2">۵. ارتقای بهره‌وری انرژی</h3>
                        <p class="text-sm text-slate-600">اعمال استانداردهای بهره‌وری در صنایع و ساختمان‌ها و ارتقای فرهنگ صرفه‌جویی.</p>
                    </div>
                     <div class="bg-white p-4 rounded-lg shadow">
                        <h3 class="font-bold text-teal-700 mb-2">۶. مدیریت منابع آب</h3>
                        <p class="text-sm text-slate-600">توجه ویژه به بحران آب و تأثیر آن بر نیروگاه‌های برق‌آبی در برنامه‌ریزی‌های کلان انرژی.</p>
                    </div>
                </div>
            </section>
        </main>

        <footer class="text-center mt-12 pt-6 border-t border-slate-300">
            <p class="text-sm text-slate-500">این داشبورد بر اساس گزارش "تحلیل جامع PESTLE و تفکر سیستمی در بحران عدم تعادل برق ایران" ایجاد شده است.</p>
        </footer>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const data = {
                supplyDemand: {
                    labels: ['۱۳۹۵', '۱۳۹۶', '۱۳۹۷', '۱۳۹۸', '۱۳۹۹', '۱۴۰۰', '۱۴۰۱', '۱۴۰۲'],
                    demand: [52000, 54000, 56000, 58000, 62000, 66000, 69000, 73000], 
                    supply: [50000, 51000, 51500, 52000, 53000, 54000, 55000, 56000] 
                },
                energyMix: {
                    labels: ['گاز طبیعی', 'نفت و مایعات', 'برق‌آبی', 'هسته‌ای', 'تجدیدپذیر و سایر'],
                    data: [80.2, 13.5, 3.4, 2.2, 0.7]
                },
                drivers: {
                    supply: [
                        { id: 'tech', title: 'فرسودگی و ناکارآمدی زیرساخت', icon: '🔧', content: 'بسیاری از نیروگاه‌ها قدیمی (عمر متوسط بیش از ۴۰ سال برای نیروگاه‌های بخاری) و با راندمان پایین (۳۰-۳۶٪) کار می‌کنند. این امر ظرفیت تولید قابل اتکا را کاهش داده و هزینه‌ها را افزایش می‌دهد.' },
                        { id: 'sanctions', title: 'تحریم‌های بین‌المللی', icon: '🚫', content: 'تحریم‌ها دسترسی به سرمایه‌گذاری خارجی، فناوری‌های نوین و تجهیزات ضروری برای نوسازی و توسعه نیروگاه‌ها (به‌ویژه تجدیدپذیرها) را به شدت محدود کرده‌اند.' },
                        { id: 'investment', title: 'کمبود سرمایه‌گذاری', icon: '📉', content: 'کاهش شدید سرمایه‌گذاری در بخش برق از سال ۲۰۱۸، مانع از ساخت نیروگاه‌های جدید و نوسازی شبکه فرسوده شده و رشد ظرفیت تولید را متوقف کرده است.' },
                        { id: 'water', title: 'بحران آب و خشکسالی', icon: '💧', content: 'کاهش شدید بارندگی و خشکسالی‌های پیاپی، تولید برق از نیروگاه‌های برق‌آبی را که بخش مهمی از توان تولید در زمان اوج مصرف هستند، به شدت کاهش داده است.' },
                        { id: 'governance', title: 'حکمرانی و سوءمدیریت', icon: '🏛️', content: 'سوءمدیریت مزمن، فساد و عدم وجود استراتژی ملی منسجم باعث تخصیص ناکارآمد منابع و اولویت‌دهی به پروژه‌های غیرمرتبط به جای زیرساخت‌های حیاتی شده است.' },
                        { id: 'fuel', title: 'کمبود سوخت نیروگاه‌ها', icon: '⛽', content: 'با وجود منابع عظیم گازی، به دلیل مصرف بالای داخلی و مشکلات توسعه میادین، نیروگاه‌ها در فصول سرد با کمبود گاز مواجه شده و مجبور به استفاده از سوخت‌های مایع و آلاینده‌تر می‌شوند.' }
                    ],
                    demand: [
                        { id: 'subsidy', title: 'یارانه‌های سنگین انرژی', icon: '💰', content: 'قیمت بسیار پایین و یارانه‌ای برق، انگیزه صرفه‌جویی را از بین برده و منجر به مصرف بی‌رویه و الگوهای اتلافی در بخش‌های خانگی، صنعتی و کشاورزی شده است.' },
                        { id: 'population', title: 'رشد جمعیت و شهرنشینی', icon: '👨‍👩‍👧‍👦', content: 'افزایش مداوم جمعیت (حدود ۸۰۰٬۰۰۰ مشترک جدید در سال) و رشد شهرنشینی، تقاضای برق در بخش‌های مسکونی و تجاری را به طور پیوسته افزایش می‌دهد.' },
                        { id: 'lifestyle', title: 'الگوهای مصرف و سبک زندگی', icon: '🛋️', content: 'افزایش استفاده از وسایل برقی پرمصرف، به‌ویژه سیستم‌های تهویه مطبوع در تابستان‌های گرم‌تر، فشار شدیدی بر شبکه در ساعات اوج مصرف وارد می‌کند.' },
                        { id: 'crypto', title: 'استخراج غیرمجاز رمزارز', icon: '💻', content: 'به دلیل ارزان بودن برق، استخراج غیرمجاز رمزارز به یک فعالیت سودآور تبدیل شده که مصرف برق بالایی دارد و فشار مضاعفی بر شبکه تحمیل می‌کند.' },
                        { id: 'climate', title: 'تغییرات اقلیمی', icon: '☀️', content: 'افزایش دمای هوا و موج‌های گرمای شدیدتر، تقاضا برای برق را جهت سرمایش به شدت افزایش داده و پیک مصرف تابستان را بالاتر می‌برد.' },
                        { id: 'industry', title: 'رشد تقاضای صنعتی', icon: '🏭', content: 'توسعه صنایع انرژی‌بر بدون توجه به محدودیت‌های تأمین برق، منجر به افزایش شدید تقاضا از سوی این بخش و اعمال خاموشی‌های برنامه‌ریزی‌شده برای کارخانه‌ها شده است.'}
                    ]
                }
            };


            const supplyDemandCtx = document.getElementById('supplyDemandChart').getContext('2d');
            new Chart(supplyDemandCtx, {
                type: 'line',
                data: {
                    labels: data.supplyDemand.labels,
                    datasets: [
                        {
                            label: 'تقاضای برق (مگاوات)',
                            data: data.supplyDemand.demand,
                            borderColor: 'rgb(220, 38, 38)',
                            backgroundColor: 'rgba(220, 38, 38, 0.1)',
                            fill: false,
                            tension: 0.3
                        },
                        {
                            label: 'عرضه برق (مگاوات)',
                            data: data.supplyDemand.supply,
                            borderColor: 'rgb(2, 132, 199)',
                            backgroundColor: 'rgba(2, 132, 199, 0.1)',
                            fill: false,
                            tension: 0.3
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: { display: true, text: 'روند شکاف عرضه و تقاضای برق در ایران', font: { size: 16, family: 'Vazirmatn' } },
                        tooltip: { bodyFont: { family: 'Vazirmatn' }, titleFont: { family: 'Vazirmatn' } }
                    },
                    scales: { y: { title: { display: true, text: 'مگاوات' } } }
                }
            });

            const energyMixCtx = document.getElementById('energyMixChart').getContext('2d');
            new Chart(energyMixCtx, {
                type: 'doughnut',
                data: {
                    labels: data.energyMix.labels,
                    datasets: [{
                        label: 'سهم در تولید برق',
                        data: data.energyMix.data,
                        backgroundColor: ['#0d9488', '#f97316', '#3b82f6', '#8b5cf6', '#64748b'],
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: { display: true, text: 'سبد تولید برق ایران (بر اساس سوخت)', font: { size: 16, family: 'Vazirmatn' } },
                        legend: { position: 'bottom', labels: { font: { family: 'Vazirmatn' } } },
                        tooltip: { bodyFont: { family: 'Vazirmatn' }, titleFont: { family: 'Vazirmatn' } }
                    }
                }
            });
            const supplyTab = document.getElementById('supply-tab');
            const demandTab = document.getElementById('demand-tab');
            const driversContent = document.getElementById('drivers-content');

            function renderDrivers(type) {
                driversContent.innerHTML = '';
                data.drivers[type].forEach(driver => {
                    const card = `
                        <div class="bg-white p-4 rounded-lg shadow-sm border border-slate-200 cursor-pointer hover:shadow-lg hover:border-teal-500 transition-all duration-300 driver-card">
                            <div class="flex items-center justify-between">
                                <h3 class="font-bold text-lg text-slate-700">${driver.title}</h3>
                                <span class="text-2xl">${driver.icon}</span>
                            </div>
                            <p class="text-sm text-slate-600 mt-2 hidden">${driver.content}</p>
                        </div>
                    `;
                    driversContent.insertAdjacentHTML('beforeend', card);
                });
                driversContent.querySelectorAll('.driver-card').forEach(card => {
                    card.addEventListener('click', () => {
                        card.querySelector('p').classList.toggle('hidden');
                        card.classList.toggle('bg-teal-50');
                    });
                });
            }

            supplyTab.addEventListener('click', () => {
                supplyTab.classList.replace('inactive-tab', 'active-tab');
                demandTab.classList.replace('active-tab', 'inactive-tab');
                renderDrivers('supply');
            });

            demandTab.addEventListener('click', () => {
                demandTab.classList.replace('inactive-tab', 'active-tab');
                supplyTab.classList.replace('active-tab', 'inactive-tab');
                renderDrivers('demand');
            });

            renderDrivers('supply');


        });
    </script>

    <script src="./dash/pages/causal-graph.js"></script>
    <script>
      // cache busting query param ensures the latest JSON is loaded
      initCausalGraph("data/causal-power-imbalance.json?v=" + Date.now());
    </script>
</body>
</html>
